#!/bin/bash

# gen_makefile.am.bs  the .bs stands for bootstrap script.

# 1.  build all [a-z]*.c as a filter module
# 2.  build all [A-Z]*.c as a uninstalled test
# 3.  Add *.h to tarball distribution 


set -e
shopt -s nullglob

# and so we can do: filters=([a-z]*.c) and not match uppercase:
shopt -s globasciiranges


cd "$(dirname ${BASH_SOURCE[0]})"

# We must be in the correct directory to run this script.
if [ ! -e ../../../../../package.make.rl ] || [ ! -e sequenceGen.c ] ; then
    echo "Running in wrong directory"
    exit 1
fi

echo "Generating $PWD/makefile.am"

# redirect all stdout from this script to the file makefile.am
exec 1> makefile.am

cat << EOF
# This file was generated by running: $0

# makefile.am for building and installing test filter modules


AM_LDFLAGS = -module -avoid-version -shared

filterdir = \$(pkglibdir)/plugins/filters/tests

EOF


echo -en "filter_LTLIBRARIES ="

filters=([a-z]*.c)

for f in ${filters[@]} ; do
    echo -en "\\\\\n ${f%%.c}.la"
done
echo -e "\n"

for f in ${filters[@]} ; do
    echo -e "${f%%.c}_la_SOURCES = ${f}"
done

echo -e "\n"


hfiles=([a-zA-Z]*.h)

echo -en "EXTRA_DIST ="

for f in ${hfiles[@]} ; do
    echo -en "\\\\\n ${f}"
done

echo -e "\n"

# build with no install
bnfiles=([A-Z]*.c)

echo -en "noinst_PROGRAMS ="

for f in ${bnfiles[@]} ; do
    echo -en "\\\\\n ${f%%.c}"
done

echo -e "\n"

for f in ${bnfiles[@]} ; do
    echo "${f%%.c}_SOURCES = ${f}"
done

echo
