#!/bin/bash

#
# This script deletes generated files.
#
# This script should not delete any user custom files so long as the file
# names are not matching files and wild card expressions in this script.
#


if [ -n "$1" ] && [ "$1" != "-x" ] ; then
    cat << EOF

  Usage: $0 [-x]|[-h|--help]

    Remove generated files; that's all generated files that are not
  checked into a repository.  This will not remove users files that are
  not built from the scripts here in.  So ya, this will not delete your
  notes, assuming you don't put them in a autotools .lib/ directory or
  something like that.

    If you wish to remove files needed to bring this source to a fresh
  tarball state run "make distclean".


            OPTIONS

       -h|--h   print this help and exit

       -x       remove the automatically downloaded files too


EOF
    exit 1
fi


set -ex


cd $(dirname ${BASH_SOURCE[0]})


# The extra clean option.  quickbuild.make is downloaded.
#
# We don't remove it by default, without the -x extra clean command-line
# option:
[ -n "$1" ] && rm -f quickbuild.make dev_tests/scc-snapshots-6.80.tgz


for f in NEWS README AUTHORS ChangeLog ; do
    if [ -e $f ] && [ ! -s $f ] ; then
        rm $f
    fi
done

docdir=share/doc/quickstream

# Remove all the GNU autotools related generated files
#
rm -f\
 COPYING\
 INSTALL\
 ar-lib\
 aclocal.m4\
 compile\
 config.guess\
 config.sub\
 ltmain.sh\
 missing\
 libtool\
 configure\
 configure.ac\
 config.status\
 config.log\
 depcomp\
 install-sh\
 stamp-h1\
 $docdir/prefix.make

rm -rf autom4te.cache/ m4/

for dir in .\
 bin\
 lib\
 include/quickstream\
 lib/quickstream/plugins/filters\
 lib/quickstream/plugins/filters/tests\
 share/bash-completion/completions\
 lib/quickstream/misc\
 $docdir ; do
    rm -f $dir/makefile.in $dir/makefile
done


# generated documentation
#

rm -f\
 $docdir/images/*.png\
 $docdir/images/*.svg\
 $docdir/html/*.png\
 $docdir/html/*.js\
 $docdir/html/*.css\
 $docdir/html/*.png\
 $docdir/html/*.html\
 $docdir/html/*.md5\
 $docdir/html/*.map\
 $docdir/Doxyfile

rm -rf $docdir/latex/ $docdir/html/search/


# Remove the autotools code built files
#
for d in bin lib lib/quickstream/plugins/filters\
    lib/quickstream/plugins/filters/tests ; do
    rm -rf $d/.deps/ $d/.libs/
    rm -f $d/*.o $d/*.so $d/*.lo $d/*.la
done

rm -f\
 bin/quickstream\
 lib/pkgconfig/quickstream.pc\
 include/quickstream/app.h



# Remove files specific to building with quickbuild
#
rm -rf\
 bin/qb_build/\
 lib/qb_build/\
 lib/quickstream/plugins/filters/qb_build/\
 lib/quickstream/plugins/filters/tests/qb_build/\
 dev_tests/qb_build/

rm -f\
 dev_tests/run\
 dev_tests/run2\
 dev_tests/test_qsError\
 quickbuild.make.org\
 quickbuild.make.tmp\
 config.make\
 config.make.example\
 package.make


# Remove some files from dev_test/

cd dev_tests
rm -rf\
 qb_build/\
 scc-snapshots-*_src
rm -f\
 *.tmp\
 assert\
 getOpts\
 run\
 run2\
 test_qsError
cd -


# Remove some files from tests/

rm -rf tests/qb_build/ tests/filters/qb_build/ tests/tests
rm -f tests/*.tmp tests/filters/my_stdout.so


# Remove some files from tests/interactive_tests/

cd tests/interactive_tests/
rm -rf qb_build/
rm -f *.tmp *.o dot_graph_3stream dot_graph_00
cd -

# This file is generated by running
# lib/quickstream/plugins/filters/tests/gen_makefile.am.bs
rm -f lib/quickstream/plugins/filters/tests/makefile.am

# Remove some files from lib/quickstream/misc
rm -rf lib/quickstream/misc/qb_build
rm -f lib/quickstream/misc/qsOptions.h lib/quickstream/misc/quickstreamHelp


cd lib/quickstream/plugins/filters/tests/
rm -f Sequence X0 X1
cd -

cd share/doc/quickstream
rm -f complexFlow.dot simpleFlow.dot stdinStdout.dot mainpage.dox quickstreamIntro.htm quickstreamOptions.htm
cd -

cd share/bash-completion/completions
rm -f quickstream
cd -

cd lib/quickstream/misc/
rm -rf .deps/
rm -f *.o quickstreamHelp.c
cd -

